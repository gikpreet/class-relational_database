= 트랜잭션

* 분해가 불가능한 프로그램의 실행단위
* ACID
** Atomicity (원자성) +
관련 작업이 전부 처리되거나 아예 처리되지 않아야 함
** Consistency(일관성) +
트랜잭션 이전과 이후에 데이터베이스의 상태는 이전과 같이 유효해야 함
** Isolation(격리성) +
모든 트랜잭션은 다른 트랜잭션들로부터 독립되어 동작해야 함
** Durability(지속성) +
트랜잭션이 성공적으로 수행되었다면 완료의 효과는 지속되어야 함
* 원자성과 지속성을 위해 데이터베이스 로그(Log)와 로그 우선 기록(Write Log Ahead)을 사용
* 격리성을 위해 잠금 규약(Locking Protocol)을 사용
* 일관성을 위해 제약 조건(Constraint)을 사용

---

트랜잭션(Transaction)은 데이터베이스 관리 시스템에서 사용자 프로그램의 실행 단위입니다. 동일한 동작을 여러 번 수행하는 경우 동작만큼의 트랜잭션이 발생합니다. 데이터베이스 관리 시스템에 요구되는 동시 접근 제어와 복구에 관련된 문제를 해결하기 위해서 데이터베이스 관리 시스템은 트랜잭션을 구현합니다. 트랜잭션은 ACID라 불리는 성질들을 만족해야 합니다. 

ACID는 데이터베이스의 트랜잭션이 안전하기 수행된다는 것을 보장하기 위한 성질을 가리키는 약어이며, 1983년 정리되었습니다.

* **Atomicity (원자성)** +
트랜잭션과 관련된 작업들이 부분적으로 실행되다가 중단되지 않는 것을 보장하는 능력입니다. 예를 들어, 은행 업무에서 계좌 이체는 성공할 수도 있고 실패할 수도 있으나 한쪽의 작업, 즉 돈을 인출하는 작업 또는 인출한 돈을 입금하는 작업 둘 중 하나만 성공하고 하나는 실패하는 경우가 없이 모두 성공하거나 모두 실패해야 한다는 것을 의미합니다. 원자성은 이와 같이 중간 단계까지 실행되고 도중에 실패하는 일이 없도록 보장되는 성질을 의미합니다.
* **Consistency(일관성)** +
트랜잭션이 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 유지하는 것을 의미합니다. 사용자 ID가 반드시 존재해야 한다는 규칙이 데이터베이스에 존재한다면 모든 트랜잭션은 이를 준수해야 하며, 이 경우 ID를 삭제하거나 Null로 만드는 트랜잭션을 실행될 수 없습니다.
* **Isolation(격리성)** +
트랜잭션이 수행될 때 다른 트랜잭션의 작업이 끼어들지 못하도록 하는 것을 의미합니다. 이는 트랜잭션 밖에 있는 어떤 연산도 중간 단계의 데이터를 볼 수 없음을 의미합니다. 성능과 관련된 이유로 가장 유연서 있는 성질에 해당합니다.
* **Durability(지속성)** +
성공적으로 수행된 트랜잭션은 완료의 효과는 영구적이어야 한다는 성질입니다. 시스템에 오류가 발생하거나 일관성 검증을 수행하더라도 성공적으로 수행된 트랜잭션은 데이터베이스에 적용되어야 함을 의미합니다. 모든 트랜잭션은 로그로 남고 시스템 장애 발생 전 상태로 되돌릴 수 있어야 하며, 트랜잭션은 로그에 저장된 후 commit 상태로 간주되어야 합니다.

데이터베이스 관리 시스템은 원자성과 지속성을 위해 일반적으로 잠금 규약(Locking Protocol)을 이용합니다. 예를 들어 어떤 DBMS가 지원하는 잠금(Lock)에 공용 잠금(Sharded Lock)과 전용 잠금(Exclusive Rock)의 두 가지가 있을 경우, 공용 잠금은 한 객체에 대해 여러 트랜잭션이 동시에 걸 수 있는 반면 전용 잠금은 한 객체에 어떤 트랜잭션이 잠금을 적용하면 다른 트랜잭션은 잠금을 걸 수 없도록 합니다. 

트랜잭션이 읽으려고 하는 모든 객체들에 대해서는 모두 공용 잠금을 건다고 하고 수정을 필요로 하는 객체들에 대해서는 전용 잠금을 거는 경우라고 가정합시다. 두 트랜잭션 T1, T2가 있어서 T1은 한 데이터 객체를 수정하려고 하고 T2는 그 데이터 객체를 읽으려고 한다고 할 경우, T2는 그 데이터 객체에 대해 공용 잠금을 요청하기 때문에 T1이 동일 객체에 대한 전용 잠금을 요청해놓으면 그 잠금을 해제하기 전에는 T2가 더 이상 진행될 수 없습니다. 따라서 데이터를 수정하는 트랜잭션 T1의 모든 동작이 완료되고 난 후에 R2의 작업이 시작됩니다.

image:../images/image06.png[]
 
데이터베이스 관리 시스템은 원자성을 달성하기 위하여 완료되지 않은 트랜잭션의 단위 작업들을 무효화합니다. 이를 위하여 데이터베이스 관리 시스템은 데이터베이스에 대한 모든 기록 작업에 대한 로그(Log)를 유지 관리합니다. 로그의 중요한 성질 중 하나는 모든 기록 동작에 대해서 그에 대한 실제 변경 내용이 데이터베이스 자체에 반영되기 전에 디스크 상의 로그에 기록해 둔다는 것입니다. 이는 지속성을 달성하도록 하며, 이런 기능을 `로그 우선 기록(WAL - Write Log Ahead)` 이라고 합니다.

---

link:./02-7_concurrency.adoc[이전: 동시 접근 및 복구] +
link:./02-9_dbms_architecture.adoc[다음: 데이터베이스 구조]