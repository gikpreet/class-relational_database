= 스키마 정제

* 개체 집합 스키마 정제
+
----
{EmpID} → {EmpID, Name, Parkingslot, Grade, WagePerHr, Workingtime}
    E        E      N       P           G       W           H
----
* 등급에 따라 시간당 임금이 결정될 경우 두 FD가 존재
+
----
E → ENGWH   G → W
----
* 부분적 함수 종속
** 기본 키 구성 속성의 일부에 종속되거나, 기본 키가 아닌 다른 속성에 종속되는 경우
* 이행적 함수 종속
** 함수 종속에 이행이 있을 때 (A → B, B → C = A → C)
* 완전 함수 종속
** 함수 종속 X → Y에서 X로부터 속성 A를 제거하면 함수 종속 X → Y가 성립하지 않는 경우
** 즉, 임의의 속성 A ∈ X 에 대해서 Y가 (X{A})에 함수 종속되지 않는 경우

---

ER 설계로 만들어내는 스키마에는 중복성 문제가 잠복해 있을 가능성이 있습니다. ER 설계는 복잡하고 주관적인 과정이며 또 어떤 제약조건들은 ER 다이어그램으로 표현할 수 없기 떄문입니다. 

== 개체 집합에 대한 제약조건

Parttime_emp 릴레이션을 다시 생각해보면, 속성 EmpID가 가지는 제약 조건은 다음과 같은 함수 종속으로 표현할 수 있습니다.

_{EmpID} → {EmpID, Name, Parkingslot, Grade, WagePerHr, Workingtime}_

이 함수종속을 속성의 첫 문자만을 따서 _E → ENPGWT_ 로 표기할 수 있습니다. (양쪽에 속성 집합이 나올 수 있습니다) Parttime_emp 릴레이션에는 E → ENPGWT 함수 종속이 있고, 또 시간당 임금을 표시하는 WagePerHr 속성은 Grade 속성에 좌우되므로, G → W 함수 종속성이 생깁니다.

앞서 예에서 이 함수 종속 때문에 등급과 임금 관련하여 중복된 데이터를 저장하게 되었습니다. ER 모델에서는 키 제약조건이라는 특수한 경우만 지원하므로 이런 내용은 표시할 수 없습니다. ER 모델링 기간에는 Parttime_Emp라는 개체 집합에서는 이런 사실을 알아낼 수 없습니다. 

이 문제는 애초의 설계가 잘못 되었기 때문이라고 생각할 수 있습니다. Wage 라는 개체 집합을 도입하고 Wage와 Parttime_Emp 사이에 관계를 넣으면 문제를 해결할 수 있다고 생각할 수도 있습니다. ER 모델링의 성질상 원래의 설계대로 가기가 쉽고, 따라서 이런 설계상의 문제를 찾아내고 더 좋은 설계를할 할 수 있도록 해주는 정규화된 기법을 사용할 수 있으면 큰 도움이 됩니다.

== 관계 집합에 대한 제약조건

아래와 같이 부품, 공급자, 부서 세 개체집합이 있고, 이 세 개체집합이 모두 관여하는 관계집합 계약이 있는 경우를 생각해봅시다.

image:../images/image01.png[]

계약 관계집합의 스키마를 _CQPSD_ 로 표현할 수 있습니다. 계약번호가 C인 계약은 공급자 S가 Q 만큼의 부품 P를 부서 D에 공급하기로 했음을 나타냅니다. 

내부 방침상 한 부서가 한 공급자로부터 한 종류의 부품밖에 구매할 수 없다고 합시다. 그렇게 되면 동일한 공급자와 부서간에 여러 건의 계약이 있을 경우 이 모든 계약에서 부품은 항상 동일합니다. 이 제약조건은 FD가 되며, _DS → P_ 로 표시됩니다.

따라서 중복성이 발생하며 문제를 일으키게 됩니다. 이런 상황을 해결하려면 계약 릴레이션을 두 릴레이션으로 분해하여 하나는 CPSD, 하나는 SDP가 되게 해야 합니다. 릴레이션 SDP는 공급자가 부서에게 공급하는 부품을 기록하며 릴레이션 CPSD는 각 계약에 대한 추가 정보들을 기록합니다. ER 모델링 만으로는 이렇게 설계하기 어렵습니다.

link:./07_functional_dependency.adoc[다음: 함수 종속 이해]