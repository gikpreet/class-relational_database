= 참여 제약조건

* 한 개체집합 E의 관계집합 R로의 참가는 모든 E의 개체가 적어도 R 내부의 한 관계에 참가한다면 이는 전체적 참가이다.
* 만약 개제 집합 E의 일부 개체들만 R의 관계에 참여한다면 개체 집합 E의 관계 R로의 참가는 부분적 참가이다.

---

관리 관계에 대한 키 제약조건은 한 부서에 최대 한 명의 부서장이 있을 수 있다는 사실을 말해줍니다. 그렇다면 모든 부서에 부서장이 존재하는가 하는 질문이 있을 수 있습니다. 모든 부서에 부서장이 필요하다고 가정해 봅시다. 이런 요건이 **참여 제약조건(Participation Constraint)**의 한 예가 됩니다.

관리 관계집합에서 부서 개체집합의 참여도를 **전체적(Total)**이라고 합니다. 관리 릴레이션의 입장에서 보면 이 제약조건은 부서 릴레이션에 나타나는 모든 부서번호 값이 관리 릴레이션에 적어도 한 투플 이상 나타내야 하고 사번 필드 값은 널이어서는 안된다는 뜻입니다. 한 부서에는 한 명의 부서장만이 존재해야 한다는 키 제약조건과 같이 생각하면, 각 부서는 부서장이 있어야 하며 반드시 한 명이어야 한다는 것입니다. 

전체적이 아닌 참여도를 **부분적(Partial)**이라고 합니다. 모든 직원이 부서를 관리하지는 않으므로 관리 관계집합에 대한 직원 개체집합의 참여도는 부분적이 됩니다.

image:./images/image11.png[]
 
근무 관계집합은 모든 직원들은 적어도 한 부서에서 근무하고 또 각 부서에는 적어도 한 명의 직원이 근무한다고 짐작할 수 있습니다. 이 말은 직원 개체집합과 부서 개체집합이 모두 근무 관계집합에 전체적으로 참여하고 있음을 뜻합니다. 

== 관계 모델로 변환

모든 부서에는 부사장이 한 명씩 있어야 한다는 제약조건을 DDL 문으로 표시하면 아래와 같이 됩니다.

[source, sql]
----
CREATE TABLE 부서 (
	부서번호 	int,
	부서이름 	varchar(10),
	예산		decimal,
	부서장사번	int,
	근무시작일	date,

	CONSTRAINT pk_부서 PRIMARY KEY(부서번호),
	CONSTRAINT fk_부서_부서장 FOREIGN KEY(사번) REFERENCES 직원(사번) ON DELETE NO ACTION
)
----

부서장 사번에는 널 값이 들어갈 수 없으므로 부서의 각 투플은 부서장에 해당하는 직원의 한 투플을 가리키게 되며, 따라서 참여 제약조건이 만족됩니다. 참조 키의 집행이 ON DELETE NO ACTION이므로 부서장사번 레코드가 가리키는 직원 투플은 삭제할 수 없습니다. 직원 레코드를 삭제하려면 이를 가리키는 부서 레코드가 다른 직원을 가리키도록 바꾸어 놓아야 합니다. 

만약 아래와 같은 방법으로 ER 모델을 관계 모델로 변환한다면, 모든 부서에 부서장이 한 명씩 반드시 존재해야 한다는 제약조건을 만족하지 못합니다. 

[source, sql]
----
CREATE TABLE 관리 (
	사번	int,
	부서번호	int,
	부임일	date,
	
	CONSTRAINT pk_관리 PRIMARY KEY(부서번호),
	CONSTRAINT fk_관리_직원 FOREIGN KEY(사번) REFERENCES 직원(사번),
	CONSTRAINT fk_관리_부서 FOREIGN KEY(부서번호) REFERENCES 부서(부서번호)
)
----

관리 관계집합과 같은 일대다 관계에 있어서, 특히 해당 개체 집합이 키 제약조건과 전체 참여 제약조건을 동시에 가지고 있을 경우 첫 번째 방식이 선호됩니다.

테이블 제약 조건이나 SQL-92 표준으로는 표현할 수 있는 참여 제약조건들이 있습니다. SQL 언어의 모든 표현력을 동연한다면 테이블 제약조건들을 명세할 수 있으나, 이들을 검사하고 집행하는 데는 비용이 많이 소요될 수 있습니다. 

만약 근무 릴레이션에 대한 참여 제약조건은 일반적인 제약조건 명세법을 이용하지 않는다면 집행할 수 없습니다. 근무 릴레이션을 보면, 사번 필드와 부서번호 필드가 있는데 이들은 각기 직원 릴레이션과 부서 릴레이션을 참조하는 외래 키 들입니다. 근무에 대해 부서가 전체적으로 참여하도록 하려면 부서 릴레이션의 모든 부서번호 값들이 근무 릴레이션에서도 어느 한 투플에 나타나도록 해 주어야 합니다. 이를 위해 부서 릴레이션의 부서번호를 근무 릴레이션을 참조하는 외래 키로 선언할 수 있겠지만, 부서번호를 근무 릴레이션에서 후보키가 될 수 없으므로 외래 키 제약조건을 만들 수 없습니다.
SQL-92 표준으로 근무에 대한 부서의 전체 참여를 보장하려면 CHECK를 사용해야 할 수도 있습니다. 부서 릴레이션에 나오는 모든 부서번호 값들이 근무 릴레이션의 어느 한 투플에는 나와야 하고, 뿐만 아니라 이에 해당하는 근무 투플에서 이 관계에 참여하는 다른 개체집합을 참조하는 외래 키 필드에 널 값이 들어가서는 안되도록 보장해 주어야 합니다. 

키 제약조건과 외래 키 제약조건으로 참여 제약조건을 표한할 수 있는 특수한 경우는 또 한가지가 있는데, 참여하는 모든 개체집합에 해하여 키 제약조건과 전체 참여 제약조건이 붙은 관계집합입니다. 이 경우 가장 좋은 변환 방식은 모든 개체들과 이 관계를 하나의 테이블로 매핑하는 것입니다.

link:./11_weakly_entityset.adoc[다음: 약 개체집합]